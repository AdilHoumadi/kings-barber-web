import{b as se,u as P,r,j as e,C as A,a as _}from"./index-7jFoioyk.js";import{S as ae}from"./ServiceCard-BDTs1qTF.js";import{r as oe,e as ne,C as re,D as ie,a as Z,f as l,L as le}from"./style-DqmNiWUz.js";import{S as ce}from"./SEO-CmSn6eBV.js";import"./user-D8vttCGL.js";import"./clock-CHl22iAK.js";const de=()=>{const m=se(),{t:s,i18n:q}=P("common"),$=q.language==="ro"?oe:ne,[x,w]=r.useState(1),[z,H]=r.useState(!1),[M,R]=r.useState([]),[c,G]=r.useState([]);r.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"})},[x]);const[o,K]=r.useState(),[g,J]=r.useState(""),[F,b]=r.useState([]),[i,v]=r.useState({fullName:"",phone:"",email:"",message:""}),[u,Q]=r.useState({maxBookingDays:7,openTime:"10:00",closeTime:"20:00",slotDuration:60});r.useEffect(()=>{(async()=>{try{const a=await _.get("/config");Q(a.data)}catch(a){console.error("Failed to fetch salon config:",a)}})()},[]),r.useEffect(()=>{(async()=>{try{const a=await _.get("/services");R(a.data)}catch(a){console.error("Failed to fetch services",a),R([{id:1,name:s("services_data.s1_name"),price:50,duration:30,description:s("services_data.s1_desc")},{id:2,name:s("services_data.s2_name"),price:80,duration:45,description:s("services_data.s2_desc")},{id:3,name:s("services_data.s3_name"),price:40,duration:20,description:s("services_data.s3_desc")}])}})()},[]),r.useEffect(()=>{if(!o){b([]);return}(async()=>{try{const a=l(o,"yyyy-MM-dd"),d=await _.get(`/availability/${a}`),{startTime:p,endTime:T,slotDuration:k,isClosed:C,bookedSlots:S}=d.data;if(C){b([]);return}const h=[],[E,L]=p.split(":").map(Number),[f,O]=T.split(":").map(Number);let n=E*60+L;const y=f*60+O,j=u.timeZone||"Europe/Bucharest",B=new Date().toLocaleString("en-US",{timeZone:j}),N=new Date(B),X=l(o,"yyyy-MM-dd")===l(N,"yyyy-MM-dd"),Y=N.getHours()*60+N.getMinutes();for(;n<y;){if(X&&n<Y){n+=k;continue}const ee=Math.floor(n/60),te=n%60,U=`${String(ee).padStart(2,"0")}:${String(te).padStart(2,"0")}`;(!S||!S.includes(U))&&h.push(U),n+=k}b(h)}catch(a){console.error("Failed to fetch availability",a);const[d,p]=u.openTime.split(":").map(Number),[T,k]=u.closeTime.split(":").map(Number),C=d*60+p,S=T*60+k,h=[];for(let n=C;n<S;n+=u.slotDuration){const y=Math.floor(n/60),j=n%60;h.push(`${String(y).padStart(2,"0")}:${String(j).padStart(2,"0")}`)}const E=u.timeZone||"Europe/Bucharest",L=new Date().toLocaleString("en-US",{timeZone:E}),f=new Date(L);if(o&&l(o,"yyyy-MM-dd")===l(f,"yyyy-MM-dd")){const n=f.getHours()*60+f.getMinutes(),y=h.filter(j=>{const[B,N]=j.split(":").map(Number);return B*60+N>=n});b(y)}else b(h)}})()},[o]);const V=t=>{G(a=>a.includes(t)?a.filter(d=>d!==t):[...a,t])},D=()=>M.filter(t=>c.includes(t.id)).reduce((t,a)=>t+a.price,0),I=()=>M.filter(t=>c.includes(t.id)).reduce((t,a)=>t+a.duration,0),W=async t=>{if(t.preventDefault(),!(!o||!g||c.length===0)){H(!0);try{await _.post("/appointments",{...i,appointmentDate:l(o,"yyyy-MM-dd"),appointmentTime:g,services:c,totalPrice:D()});const a=new URLSearchParams({date:l(o,"yyyy-MM-dd"),time:g,name:i.fullName,duration:String(I())});m(`/success?${a.toString()}`)}catch(a){if(console.error("Booking failed",a),a.response?.status===429&&a.response?.data?.code==="BOOKING_RATE_LIMIT"){const d=a.response.data.retryAfterSeconds,p=Math.ceil(d/60);alert(s("booking.alert_rate_limit",{minutes:p}))}else alert(s("booking.alert_error"))}finally{H(!1)}}};return e.jsxs("div",{className:"bg-dark-800 rounded-2xl p-6 md:p-8 shadow-xl border border-white/10",children:[e.jsxs("div",{className:"flex justify-between mb-8 relative",children:[e.jsx("div",{className:"absolute top-1/2 left-0 w-full h-0.5 bg-dark-700 -z-10"}),[1,2,3].map(t=>e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center font-bold transition-colors ${x>=t?"bg-gold-500 text-dark-900":"bg-dark-700 text-gray-400"}`,children:x>t?e.jsx(re,{className:"h-6 w-6"}):t},t))]}),e.jsxs("form",{onSubmit:W,children:[x===1&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:s("booking.step_1_title")}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:M.map(t=>e.jsx(ae,{...t,selected:c.includes(t.id),onSelect:()=>V(t.id)},t.id))}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t border-white/10",children:[e.jsxs("div",{className:"text-white",children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Total estimat:"}),e.jsxs("p",{className:"text-2xl font-bold text-gold-500",children:[D()," RON"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[I()," min"]})]}),e.jsxs("button",{type:"button",disabled:c.length===0,onClick:()=>w(2),className:"bg-gold-500 text-dark-900 px-6 py-3 rounded-lg font-bold disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gold-400 transition-colors flex items-center gap-2",children:[s("booking.next")," ",e.jsx(A,{className:"h-4 w-4"})]})]})]}),x===2&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:s("booking.step_2_title")}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[e.jsx("div",{className:"bg-dark-900 p-4 rounded-xl border border-white/10",children:e.jsx(ie,{mode:"single",selected:o,onSelect:K,locale:$,disabled:[{before:new Date},{after:new Date(new Date().setDate(new Date().getDate()+u.maxBookingDays))}],modifiersClassNames:{selected:"bg-gold-500 text-dark-900 font-bold hover:bg-gold-400",today:"text-gold-500 font-bold"},className:"text-white mx-auto"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-white font-bold mb-4",children:s("booking.avail_hours")}),o?F.length===0?e.jsx("p",{className:"text-gray-400 text-center py-8",children:"Salonul este închis în această zi"}):e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-2",children:F.map(t=>e.jsx("button",{type:"button",onClick:()=>J(t),className:`p-2 rounded-lg text-sm font-medium transition-colors ${g===t?"bg-gold-500 text-dark-900":"bg-dark-700 text-gray-300 hover:bg-dark-600"}`,children:t},t))}):e.jsx("p",{className:"text-gray-400 text-center py-8",children:"Selectează o dată mai întâi"})]})]}),e.jsxs("div",{className:"flex justify-between pt-4 border-t border-white/10",children:[e.jsxs("button",{type:"button",onClick:()=>w(1),className:"text-gray-400 hover:text-white flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4"})," Înapoi"]}),e.jsxs("button",{type:"button",disabled:!o||!g,onClick:()=>w(3),className:"bg-gold-500 text-dark-900 px-6 py-3 rounded-lg font-bold disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gold-400 transition-colors flex items-center gap-2",children:["Următorul ",e.jsx(A,{className:"h-4 w-4"})]})]})]}),x===3&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:s("booking.step_3_title")}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:s("booking.label_name")}),e.jsx("input",{type:"text",required:!0,value:i.fullName,onChange:t=>v({...i,fullName:t.target.value}),className:"w-full bg-dark-900 border border-white/10 rounded-lg p-3 text-white focus:border-gold-500 focus:ring-1 focus:ring-gold-500 outline-none transition-colors",placeholder:s("booking.placeholder_name")})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:s("booking.label_phone")}),e.jsx("input",{type:"tel",required:!0,value:i.phone,onChange:t=>v({...i,phone:t.target.value}),className:"w-full bg-dark-900 border border-white/10 rounded-lg p-3 text-white focus:border-gold-500 focus:ring-1 focus:ring-gold-500 outline-none transition-colors",placeholder:s("booking.placeholder_phone")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:s("booking.label_email")}),e.jsx("input",{type:"email",value:i.email,onChange:t=>v({...i,email:t.target.value}),className:"w-full bg-dark-900 border border-white/10 rounded-lg p-3 text-white focus:border-gold-500 focus:ring-1 focus:ring-gold-500 outline-none transition-colors",placeholder:s("booking.placeholder_email")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:s("booking.label_message")}),e.jsx("textarea",{value:i.message,onChange:t=>v({...i,message:t.target.value}),className:"w-full bg-dark-900 border border-white/10 rounded-lg p-3 text-white focus:border-gold-500 focus:ring-1 focus:ring-gold-500 outline-none transition-colors h-24 resize-none",placeholder:s("booking.placeholder_message")})]})]}),e.jsxs("div",{className:"bg-dark-900 p-4 rounded-lg border border-white/10 space-y-2",children:[e.jsx("h3",{className:"font-bold text-white",children:s("booking.summary_title")}),e.jsxs("p",{className:"text-gray-400 text-sm flex justify-between",children:[e.jsx("span",{children:s("booking.summary_services")}),e.jsx("span",{className:"text-white",children:s("booking.selected_count",{count:c.length})})]}),e.jsxs("p",{className:"text-gray-400 text-sm flex justify-between",children:[e.jsx("span",{children:s("booking.summary_date")}),e.jsx("span",{className:"text-white",children:o?l(o,"dd MMMM yyyy",{locale:$}):"-"})]}),e.jsxs("p",{className:"text-gray-400 text-sm flex justify-between",children:[e.jsx("span",{children:s("booking.summary_time")}),e.jsx("span",{className:"text-white",children:g||"-"})]}),e.jsxs("div",{className:"pt-2 border-t border-white/10 flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:s("booking.summary_total")}),e.jsxs("span",{className:"text-xl font-bold text-gold-500",children:[D()," RON"]})]})]}),e.jsxs("div",{className:"flex justify-between pt-4 border-t border-white/10",children:[e.jsxs("button",{type:"button",onClick:()=>w(2),className:"text-gray-400 hover:text-white flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4"})," ",s("booking.back")]}),e.jsx("button",{type:"submit",disabled:z,className:"bg-gold-500 text-dark-900 px-8 py-3 rounded-lg font-bold disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gold-400 transition-colors flex items-center gap-2",children:z?e.jsx(le,{className:"h-5 w-5 animate-spin"}):s("booking.confirm_btn")})]})]})]})]})},pe=()=>{const{t:m}=P("common");return e.jsxs("div",{className:"min-h-screen bg-dark-900 py-12 px-4 sm:px-6 lg:px-8",children:[e.jsx(ce,{title:m("booking.seo_title"),description:m("booking.seo_desc"),canonical:"https://kingsbarber.ro/booking"}),e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-10",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-white mb-4",children:m("booking.title")}),e.jsx("p",{className:"text-gray-400",children:m("booking.subtitle")})]}),e.jsx(de,{})]})]})};export{pe as default};
