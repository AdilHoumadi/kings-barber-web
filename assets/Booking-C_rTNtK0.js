import{b as ae,u as K,r as n,j as e,C as q,a as C}from"./index-B7kz_oqI.js";import{S as ne}from"./ServiceCard-zMZ82cSu.js";import{r as re,e as le,C as ie,D as ce,a as G,f as m,L as de}from"./style-fD1y47mO.js";import{S as me}from"./SEO-C0qlsdXu.js";import"./wand-Bxy0_mQ9.js";import"./user-DPiW9on2.js";import"./clock-CPt2RoOT.js";const xe=()=>{const u=ae(),{t:s,i18n:J}=K("common"),R=J.language==="ro"?re:le,[g,_]=n.useState(1),[F,O]=n.useState(!1),[E,U]=n.useState([]),[r,Q]=n.useState([]);n.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"})},[g]);const[a,V]=n.useState(),[i,A]=n.useState(""),[N,h]=n.useState([]),[l,M]=n.useState({fullName:"",phone:"",email:"",message:""}),[b,W]=n.useState({maxBookingDays:7,openTime:"10:00",closeTime:"20:00",slotDuration:60});n.useEffect(()=>{(async()=>{try{const o=await C.get("/config");W(o.data)}catch(o){console.error("Failed to fetch salon config:",o)}})()},[]),n.useEffect(()=>{(async()=>{try{const o=await C.get("/services");U(o.data)}catch(o){console.error("Failed to fetch services",o),U([{id:1,name:s("services_data.s1_name"),price:50,duration:30,description:s("services_data.s1_desc")},{id:2,name:s("services_data.s2_name"),price:80,duration:45,description:s("services_data.s2_desc")},{id:3,name:s("services_data.s3_name"),price:40,duration:20,description:s("services_data.s3_desc")}])}})()},[]),n.useEffect(()=>{if(!a){h([]);return}(async()=>{try{const o=m(a,"yyyy-MM-dd"),x=r.length>0?`?serviceIds=${r.join(",")}`:"",w=await C.get(`/availability/${o}${x}`),{isClosed:L,availableSlots:p,startTime:B,endTime:I,slotDuration:f,bookedSlots:D}=w.data;if(L){h([]);return}const z=b.timeZone||"Europe/Bucharest",v=new Date().toLocaleString("en-US",{timeZone:z}),T=new Date(v),c=m(a,"yyyy-MM-dd")===m(T,"yyyy-MM-dd"),y=T.getHours()*60+T.getMinutes();if(p&&p.length>0){const d=c?p.filter(k=>{const[S,H]=k.split(":").map(Number);return S*60+H>y}):p;h(d)}else{const d=[],[k,S]=B.split(":").map(Number),[H,ee]=I.split(":").map(Number);let j=k*60+S;const te=H*60+ee;for(;j<te;){if(c&&j<y){j+=f;continue}const se=Math.floor(j/60),oe=j%60,Z=`${String(se).padStart(2,"0")}:${String(oe).padStart(2,"0")}`;(!D||!D.includes(Z))&&d.push(Z),j+=f}h(d)}}catch(o){console.error("Failed to fetch availability",o);const[x,w]=b.openTime.split(":").map(Number),[L,p]=b.closeTime.split(":").map(Number),B=x*60+w,I=L*60+p,f=[];for(let c=B;c<I;c+=b.slotDuration){const y=Math.floor(c/60),d=c%60;f.push(`${String(y).padStart(2,"0")}:${String(d).padStart(2,"0")}`)}const D=b.timeZone||"Europe/Bucharest",z=new Date().toLocaleString("en-US",{timeZone:D}),v=new Date(z);if(a&&m(a,"yyyy-MM-dd")===m(v,"yyyy-MM-dd")){const c=v.getHours()*60+v.getMinutes(),y=f.filter(d=>{const[k,S]=d.split(":").map(Number);return k*60+S>=c});h(y)}else h(f)}})()},[a,r]),n.useEffect(()=>{i&&N.length>0&&!N.includes(i)&&A("")},[N,i]);const X=t=>{Q(o=>o.includes(t)?o.filter(x=>x!==t):[...o,t])},$=()=>E.filter(t=>r.includes(t.id)).reduce((t,o)=>t+o.price,0),P=()=>E.filter(t=>r.includes(t.id)).reduce((t,o)=>t+o.duration,0),Y=async t=>{if(t.preventDefault(),!(!a||!i||r.length===0)){O(!0);try{await C.post("/appointments",{...l,appointmentDate:m(a,"yyyy-MM-dd"),appointmentTime:i,services:r,totalPrice:$()});const o=new URLSearchParams({date:m(a,"yyyy-MM-dd"),time:i,name:l.fullName,duration:String(P())});u(`/success?${o.toString()}`)}catch(o){if(console.error("Booking failed",o),o.response?.status===429&&o.response?.data?.code==="BOOKING_RATE_LIMIT"){const x=o.response.data.retryAfterSeconds,w=Math.ceil(x/60);alert(s("booking.alert_rate_limit",{minutes:w}))}else alert(s("booking.alert_error"))}finally{O(!1)}}};return e.jsxs("div",{className:"bg-dark-800 rounded-2xl p-6 md:p-8 shadow-xl border border-white/10",children:[e.jsxs("div",{className:"flex justify-between mb-8 relative",children:[e.jsx("div",{className:"absolute top-1/2 left-0 w-full h-0.5 bg-dark-700 -z-10"}),[1,2,3].map(t=>e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center font-bold transition-colors ${g>=t?"bg-gold-500 text-dark-900":"bg-dark-700 text-gray-400"}`,children:g>t?e.jsx(ie,{className:"h-6 w-6"}):t},t))]}),e.jsxs("form",{onSubmit:Y,children:[g===1&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:s("booking.step_1_title")}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:E.map(t=>e.jsx(ne,{...t,selected:r.includes(t.id),onSelect:()=>X(t.id)},t.id))}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t border-white/10",children:[e.jsxs("div",{className:"text-white",children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Total estimat:"}),e.jsxs("p",{className:"text-2xl font-bold text-gold-500",children:[$()," RON"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[P()," min"]})]}),e.jsxs("button",{type:"button",disabled:r.length===0,onClick:()=>_(2),className:"bg-gold-500 text-dark-900 px-6 py-3 rounded-lg font-bold disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gold-400 transition-colors flex items-center gap-2",children:[s("booking.next")," ",e.jsx(q,{className:"h-4 w-4"})]})]})]}),g===2&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:s("booking.step_2_title")}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[e.jsx("div",{className:"bg-dark-900 p-4 rounded-xl border border-white/10",children:e.jsx(ce,{mode:"single",selected:a,onSelect:V,locale:R,disabled:[{before:new Date},{after:new Date(new Date().setDate(new Date().getDate()+b.maxBookingDays))}],modifiersClassNames:{selected:"bg-gold-500 text-dark-900 font-bold hover:bg-gold-400",today:"text-gold-500 font-bold"},className:"text-white mx-auto"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-white font-bold mb-4",children:s("booking.avail_hours")}),a?N.length===0?e.jsx("p",{className:"text-gray-400 text-center py-8",children:"Salonul este închis în această zi"}):e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-2",children:N.map(t=>e.jsx("button",{type:"button",onClick:()=>A(t),className:`p-2 rounded-lg text-sm font-medium transition-colors ${i===t?"bg-gold-500 text-dark-900":"bg-dark-700 text-gray-300 hover:bg-dark-600"}`,children:t},t))}):e.jsx("p",{className:"text-gray-400 text-center py-8",children:"Selectează o dată mai întâi"})]})]}),e.jsxs("div",{className:"flex justify-between pt-4 border-t border-white/10",children:[e.jsxs("button",{type:"button",onClick:()=>_(1),className:"text-gray-400 hover:text-white flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4"})," Înapoi"]}),e.jsxs("button",{type:"button",disabled:!a||!i,onClick:()=>_(3),className:"bg-gold-500 text-dark-900 px-6 py-3 rounded-lg font-bold disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gold-400 transition-colors flex items-center gap-2",children:["Următorul ",e.jsx(q,{className:"h-4 w-4"})]})]})]}),g===3&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:s("booking.step_3_title")}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:s("booking.label_name")}),e.jsx("input",{type:"text",required:!0,value:l.fullName,onChange:t=>M({...l,fullName:t.target.value}),className:"w-full bg-dark-900 border border-white/10 rounded-lg p-3 text-white focus:border-gold-500 focus:ring-1 focus:ring-gold-500 outline-none transition-colors",placeholder:s("booking.placeholder_name")})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:s("booking.label_phone")}),e.jsx("input",{type:"tel",required:!0,value:l.phone,onChange:t=>M({...l,phone:t.target.value}),className:"w-full bg-dark-900 border border-white/10 rounded-lg p-3 text-white focus:border-gold-500 focus:ring-1 focus:ring-gold-500 outline-none transition-colors",placeholder:s("booking.placeholder_phone")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:s("booking.label_email")}),e.jsx("input",{type:"email",value:l.email,onChange:t=>M({...l,email:t.target.value}),className:"w-full bg-dark-900 border border-white/10 rounded-lg p-3 text-white focus:border-gold-500 focus:ring-1 focus:ring-gold-500 outline-none transition-colors",placeholder:s("booking.placeholder_email")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:s("booking.label_message")}),e.jsx("textarea",{value:l.message,onChange:t=>M({...l,message:t.target.value}),className:"w-full bg-dark-900 border border-white/10 rounded-lg p-3 text-white focus:border-gold-500 focus:ring-1 focus:ring-gold-500 outline-none transition-colors h-24 resize-none",placeholder:s("booking.placeholder_message")})]})]}),e.jsxs("div",{className:"bg-dark-900 p-4 rounded-lg border border-white/10 space-y-2",children:[e.jsx("h3",{className:"font-bold text-white",children:s("booking.summary_title")}),e.jsxs("p",{className:"text-gray-400 text-sm flex justify-between",children:[e.jsx("span",{children:s("booking.summary_services")}),e.jsx("span",{className:"text-white",children:s("booking.selected_count",{count:r.length})})]}),e.jsxs("p",{className:"text-gray-400 text-sm flex justify-between",children:[e.jsx("span",{children:s("booking.summary_date")}),e.jsx("span",{className:"text-white",children:a?m(a,"dd MMMM yyyy",{locale:R}):"-"})]}),e.jsxs("p",{className:"text-gray-400 text-sm flex justify-between",children:[e.jsx("span",{children:s("booking.summary_time")}),e.jsx("span",{className:"text-white",children:i||"-"})]}),e.jsxs("div",{className:"pt-2 border-t border-white/10 flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:s("booking.summary_total")}),e.jsxs("span",{className:"text-xl font-bold text-gold-500",children:[$()," RON"]})]})]}),e.jsxs("div",{className:"flex justify-between pt-4 border-t border-white/10",children:[e.jsxs("button",{type:"button",onClick:()=>_(2),className:"text-gray-400 hover:text-white flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4"})," ",s("booking.back")]}),e.jsx("button",{type:"submit",disabled:F,className:"bg-gold-500 text-dark-900 px-8 py-3 rounded-lg font-bold disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gold-400 transition-colors flex items-center gap-2",children:F?e.jsx(de,{className:"h-5 w-5 animate-spin"}):s("booking.confirm_btn")})]})]})]})]})},je=()=>{const{t:u}=K("common");return e.jsxs("div",{className:"min-h-screen bg-dark-900 py-12 px-4 sm:px-6 lg:px-8",children:[e.jsx(me,{title:u("booking.seo_title"),description:u("booking.seo_desc"),canonical:"https://kingsbarber.ro/booking"}),e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-10",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-white mb-4",children:u("booking.title")}),e.jsx("p",{className:"text-gray-400",children:u("booking.subtitle")})]}),e.jsx(xe,{})]})]})};export{je as default};
