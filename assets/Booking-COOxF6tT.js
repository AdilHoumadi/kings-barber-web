import{u as Y,r as o,j as e,a as S}from"./index-Bq72KNa2.js";import{S as ee}from"./ServiceCard-CY8Ec7zj.js";import{C as te,D as se,r as H,a as I,f as c,L as ae}from"./style-CcvvJf1a.js";import{C as R}from"./user-C1WAmb-a.js";import{S as re}from"./SEO-DSTAljdO.js";import"./clock-BSf4ipQY.js";const oe=()=>{const F=Y(),[d,j]=o.useState(1),[E,A]=o.useState(!1),[k,P]=o.useState([]),[i,U]=o.useState([]);o.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"})},[d]);const[a,Z]=o.useState(),[u,q]=o.useState(""),[z,h]=o.useState([]),[n,N]=o.useState({fullName:"",phone:"",email:"",message:""}),[m,K]=o.useState({maxBookingDays:7,openTime:"10:00",closeTime:"20:00",slotDuration:60});o.useEffect(()=>{(async()=>{try{const s=await S.get("/config");K(s.data)}catch(s){console.error("Failed to fetch salon config:",s)}})()},[]),o.useEffect(()=>{(async()=>{try{const s=await S.get("/services");P(s.data)}catch(s){console.error("Failed to fetch services",s),P([{id:1,name:"Tuns Clasic",price:50,duration:30,description:"Tuns clasic din foarfecă și mașină"},{id:2,name:"Tuns + Barbă",price:80,duration:45,description:"Pachet complet tuns și aranjat barbă"},{id:3,name:"Barbă",price:40,duration:20,description:"Contur și aranjat barbă"}])}})()},[]),o.useEffect(()=>{if(!a){h([]);return}(async()=>{try{const s=c(a,"yyyy-MM-dd"),l=await S.get(`/availability/${s}`),{startTime:g,endTime:T,slotDuration:w,isClosed:D,bookedSlots:v}=l.data;if(D){h([]);return}const x=[],[C,O]=g.split(":").map(Number),[p,$]=T.split(":").map(Number);let r=C*60+O;const b=p*60+$,f=m.timeZone||"Europe/Bucharest",B=new Date().toLocaleString("en-US",{timeZone:f}),y=new Date(B),J=c(a,"yyyy-MM-dd")===c(y,"yyyy-MM-dd"),Q=y.getHours()*60+y.getMinutes();for(;r<b;){if(J&&r<Q){r+=w;continue}const W=Math.floor(r/60),X=r%60,L=`${String(W).padStart(2,"0")}:${String(X).padStart(2,"0")}`;(!v||!v.includes(L))&&x.push(L),r+=w}h(x)}catch(s){console.error("Failed to fetch availability",s);const[l,g]=m.openTime.split(":").map(Number),[T,w]=m.closeTime.split(":").map(Number),D=l*60+g,v=T*60+w,x=[];for(let r=D;r<v;r+=m.slotDuration){const b=Math.floor(r/60),f=r%60;x.push(`${String(b).padStart(2,"0")}:${String(f).padStart(2,"0")}`)}const C=m.timeZone||"Europe/Bucharest",O=new Date().toLocaleString("en-US",{timeZone:C}),p=new Date(O);if(a&&c(a,"yyyy-MM-dd")===c(p,"yyyy-MM-dd")){const r=p.getHours()*60+p.getMinutes(),b=x.filter(f=>{const[B,y]=f.split(":").map(Number);return B*60+y>=r});h(b)}else h(x)}})()},[a]);const V=t=>{U(s=>s.includes(t)?s.filter(l=>l!==t):[...s,t])},M=()=>k.filter(t=>i.includes(t.id)).reduce((t,s)=>t+s.price,0),_=()=>k.filter(t=>i.includes(t.id)).reduce((t,s)=>t+s.duration,0),G=async t=>{if(t.preventDefault(),!(!a||!u||i.length===0)){A(!0);try{await S.post("/appointments",{...n,appointmentDate:c(a,"yyyy-MM-dd"),appointmentTime:u,services:i,totalPrice:M()}),F("/success")}catch(s){if(console.error("Booking failed",s),s.response?.status===429&&s.response?.data?.code==="BOOKING_RATE_LIMIT"){const l=s.response.data.retryAfterSeconds,g=Math.ceil(l/60);alert(`Prea multe programări! Vă rugăm să așteptați ${g} minute înainte de a face o nouă programare.`)}else alert("A apărut o eroare. Vă rugăm să încercați din nou.")}finally{A(!1)}}};return e.jsxs("div",{className:"bg-dark-800 rounded-2xl p-6 md:p-8 shadow-xl border border-white/10",children:[e.jsxs("div",{className:"flex justify-between mb-8 relative",children:[e.jsx("div",{className:"absolute top-1/2 left-0 w-full h-0.5 bg-dark-700 -z-10"}),[1,2,3].map(t=>e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center font-bold transition-colors ${d>=t?"bg-gold-500 text-dark-900":"bg-dark-700 text-gray-400"}`,children:d>t?e.jsx(te,{className:"h-6 w-6"}):t},t))]}),e.jsxs("form",{onSubmit:G,children:[d===1&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Alege Serviciile"}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:k.map(t=>e.jsx(ee,{...t,selected:i.includes(t.id),onSelect:()=>V(t.id)},t.id))}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t border-white/10",children:[e.jsxs("div",{className:"text-white",children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Total estimat:"}),e.jsxs("p",{className:"text-2xl font-bold text-gold-500",children:[M()," RON"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[_()," min"]})]}),e.jsxs("button",{type:"button",disabled:i.length===0,onClick:()=>j(2),className:"bg-gold-500 text-dark-900 px-6 py-3 rounded-lg font-bold disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gold-400 transition-colors flex items-center gap-2",children:["Următorul ",e.jsx(R,{className:"h-4 w-4"})]})]})]}),d===2&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Alege Data și Ora"}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[e.jsx("div",{className:"bg-dark-900 p-4 rounded-xl border border-white/10",children:e.jsx(se,{mode:"single",selected:a,onSelect:Z,locale:H,disabled:[{before:new Date},{after:new Date(new Date().setDate(new Date().getDate()+m.maxBookingDays))}],modifiersClassNames:{selected:"bg-gold-500 text-dark-900 font-bold hover:bg-gold-400",today:"text-gold-500 font-bold"},className:"text-white mx-auto"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-white font-bold mb-4",children:"Ore Disponibile"}),a?z.length===0?e.jsx("p",{className:"text-gray-400 text-center py-8",children:"Salonul este închis în această zi"}):e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-2",children:z.map(t=>e.jsx("button",{type:"button",onClick:()=>q(t),className:`p-2 rounded-lg text-sm font-medium transition-colors ${u===t?"bg-gold-500 text-dark-900":"bg-dark-700 text-gray-300 hover:bg-dark-600"}`,children:t},t))}):e.jsx("p",{className:"text-gray-400 text-center py-8",children:"Selectează o dată mai întâi"})]})]}),e.jsxs("div",{className:"flex justify-between pt-4 border-t border-white/10",children:[e.jsxs("button",{type:"button",onClick:()=>j(1),className:"text-gray-400 hover:text-white flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4"})," Înapoi"]}),e.jsxs("button",{type:"button",disabled:!a||!u,onClick:()=>j(3),className:"bg-gold-500 text-dark-900 px-6 py-3 rounded-lg font-bold disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gold-400 transition-colors flex items-center gap-2",children:["Următorul ",e.jsx(R,{className:"h-4 w-4"})]})]})]}),d===3&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Datele Tale"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Nume Complet"}),e.jsx("input",{type:"text",required:!0,value:n.fullName,onChange:t=>N({...n,fullName:t.target.value}),className:"w-full bg-dark-900 border border-white/10 rounded-lg p-3 text-white focus:border-gold-500 focus:ring-1 focus:ring-gold-500 outline-none transition-colors",placeholder:"Ion Popescu"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Telefon"}),e.jsx("input",{type:"tel",required:!0,value:n.phone,onChange:t=>N({...n,phone:t.target.value}),className:"w-full bg-dark-900 border border-white/10 rounded-lg p-3 text-white focus:border-gold-500 focus:ring-1 focus:ring-gold-500 outline-none transition-colors",placeholder:"07xx xxx xxx"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Email (Opțional)"}),e.jsx("input",{type:"email",value:n.email,onChange:t=>N({...n,email:t.target.value}),className:"w-full bg-dark-900 border border-white/10 rounded-lg p-3 text-white focus:border-gold-500 focus:ring-1 focus:ring-gold-500 outline-none transition-colors",placeholder:"email@exemplu.com"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Mesaj (Opțional)"}),e.jsx("textarea",{value:n.message,onChange:t=>N({...n,message:t.target.value}),className:"w-full bg-dark-900 border border-white/10 rounded-lg p-3 text-white focus:border-gold-500 focus:ring-1 focus:ring-gold-500 outline-none transition-colors h-24 resize-none",placeholder:"Alte detalii..."})]})]}),e.jsxs("div",{className:"bg-dark-900 p-4 rounded-lg border border-white/10 space-y-2",children:[e.jsx("h3",{className:"font-bold text-white",children:"Rezumat Programare"}),e.jsxs("p",{className:"text-gray-400 text-sm flex justify-between",children:[e.jsx("span",{children:"Servicii:"}),e.jsxs("span",{className:"text-white",children:[i.length," selectate"]})]}),e.jsxs("p",{className:"text-gray-400 text-sm flex justify-between",children:[e.jsx("span",{children:"Data:"}),e.jsx("span",{className:"text-white",children:a?c(a,"dd MMMM yyyy",{locale:H}):"-"})]}),e.jsxs("p",{className:"text-gray-400 text-sm flex justify-between",children:[e.jsx("span",{children:"Ora:"}),e.jsx("span",{className:"text-white",children:u||"-"})]}),e.jsxs("div",{className:"pt-2 border-t border-white/10 flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Total de plată:"}),e.jsxs("span",{className:"text-xl font-bold text-gold-500",children:[M()," RON"]})]})]}),e.jsxs("div",{className:"flex justify-between pt-4 border-t border-white/10",children:[e.jsxs("button",{type:"button",onClick:()=>j(2),className:"text-gray-400 hover:text-white flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4"})," Înapoi"]}),e.jsx("button",{type:"submit",disabled:E,className:"bg-gold-500 text-dark-900 px-8 py-3 rounded-lg font-bold disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gold-400 transition-colors flex items-center gap-2",children:E?e.jsx(ae,{className:"h-5 w-5 animate-spin"}):"Confirmă Programarea"})]})]})]})]})},xe=()=>e.jsxs("div",{className:"min-h-screen bg-dark-900 py-12 px-4 sm:px-6 lg:px-8",children:[e.jsx(re,{title:"Programări Online",description:"Programează-te online la Kings Barber Timișoara în doar câteva secunde. Alege data și ora preferată.",canonical:"https://kingsbarber.ro/booking"}),e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-10",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-white mb-4",children:"Programează-te Online"}),e.jsx("p",{className:"text-gray-400",children:"Alege serviciile dorite și data potrivită pentru tine."})]}),e.jsx(oe,{})]})]});export{xe as default};
